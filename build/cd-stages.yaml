stages:
- stage: BuildUiReact
  displayName: Build mobile-ui-react
  jobs:
    - template: ci.yaml

- stage: PublishUiReactNpmjs
  displayName: Publish mobile-ui-react to Npmjs
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'), eq(dependencies.Build.outputs['Build.checkPublish.canPublish'], 'true'), eq(variables['shouldPublish'], 'true'))
  variables:
    version: $[ stageDependencies.Build.Build.outputs['checkPublish.version'] ]

  jobs:
    - template: templates/npmjs-publish-deployment.yaml@build-pipeline-scripts
      parameters:
        path: itwin-mobile-ui-react-$(version).tgz
        artifactName: tarball
        releaseTag: latest
